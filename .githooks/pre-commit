#!/bin/bash
# Pre-commit hook: runs before each commit
# Calls Makefile targets for consistency
set -e

echo "Running pre-commit checks..."

# Check formatting
echo "  Checking format..."
make format-check

# Run linter
echo "  Running linter..."
make lint

# Check for debug statements
echo "  Checking for debug statements..."
if grep -rn "breakpoint()\|import pdb\|pdb.set_trace" --include="*.py" core/ models/ integrations/ benchmarks/ 2>/dev/null; then
    echo ""
    echo "ERROR: Debug statements found. Remove before committing."
    exit 1
fi

# Prevent direct commits to main
branch=$(git branch --show-current)
if [ "$branch" = "main" ]; then
    echo ""
    echo "ERROR: Direct commits to main not allowed. Use a feature branch."
    echo "  git checkout -b feature/your-feature-name"
    exit 1
fi

echo ""
echo "Pre-commit checks passed."
